# JavaScript自动垃圾回收机制

## 什么是自动垃圾回收机制

> 垃圾回收机制是在内存自动管理机制通过一些垃圾回收算法找出那些不在被使用的变量，进行清除并释放内存。当我们创建一个变量的时候，会自动为这个变量分配内存，当这个变量不会再被程序所访问，会在执行垃圾回收机制的的过程中被回收，释放内存。防止内存泄漏。`JavaScript`内存分为`堆内存`和`栈内存`。

## 执行上下文

> `JavaScript`有三种执行环境。全局执行上下文、函数执行上下文、`eval`执行上下文。代码执行时，首先会创建全局执行上下文，并将这个上下文压入到执行栈中，在执行过程中遇到函数执行，会创建函数执行上下文，并压入到执行栈中。当一个函数执行结束，这个函数执行上下文会从执行栈中弹出。执行上下文中包含`变量对象`、`作用域链`、`this`.

## 栈内存和堆内存

> `栈内存`中存放的都是基本数据类型。
>
> 栈内存的的垃圾回收是当一个执行上下文执行完毕后，会将这个执行上下文从执行栈中弹出并销毁。
>
> `堆内存`中存放的时候引用数据类型
>
> `JavaScript`会把堆内存分为`新生代`和`老生代`。`新生代`中存储的一般是存活时间较短的对象。`新生代`中采用 Scavenge 垃圾回收算法，将内存分为两块区域`from`和`to`。新分配的对象首先进入`from`。当`from`空间满的时候，会启动垃圾回收。将`from`中存活的对象复制到`to`中，销毁失活的对象，清空`from`中的全部内存。最后将`from`空间和`to`空间互换。等待下一次垃圾回收。当对象从`from`空间复制到`to`空间的时候，检测对象是否经历过一次垃圾回收的过程，如果经历过或者`to`空间占用新生代内存的`25%`就会将这个对象直接从`from`空间移动到`老生代`内存中。
>
> `老生代`采用标记整理和标记清除结合来进行垃圾回收，首先进入标记阶段会遍历内存中的所有对象，对活着的对象进行标记，然后进入整理阶段，将所有存活的对象向内存空间的一侧移动，进入清除阶段，将边界的另一侧内存一次性全部回收。

