# 性能优化

## 图片优化

### 图片类型选择

* JPG （.jpg/.jpeg/.jpe）

  * 有损压缩
  * 不支持透明度
  * 适合色彩丰富的大图片

* PNG

  * 无损压缩
  * 支持透明和半透明
  * 适合纯色、透明、线条、图标

* GIF

  * 支持透明
  * 适合图标、动画

* Webp

  * 优点：

    * 提供无损和有损压缩
    * 相对相同质量的其他类型图片，体积更小
    * 支持透明和半透明

  * 缺点

    * 不合适彩色图片
    * 浏览器兼容性有要求
    * 编码和解码相对其他类型图片会慢一点

    

### 图片压缩

> 使用对应的压缩工具压缩不同类型的图片。

### 图片按需加载

* 使用统一占位符
  * LOIP（低质量图片占位符）
  * SQIP（SVG图片占位符）
  * 普通的图片（logo..）

### 减少图片网络请求

* 使用`Base64`
* 使用`webFont`字体

* 使用 `CSS` 替代图片
* 使用雪碧图

### 响应式图片

* `js`检测窗口大小
* `CSS`媒体查询
* `img`标签设置 `srcset`属性

### 图片服务器

> 图片服务器根据客户端请求`URL`上的参数生成对应的图片大小、格式、质量、加水印、裁剪、模糊处理等。以应对不同场景、设备、网络、终端下对同一张原始图片的请求。
>
> `nginx` :[PageSpeed` 模块](https://www.modpagespeed.com/doc/build_ngx_pagespeed_from_source#dependencies)



## HTML 优化

### 精简HTML代码

* 减少嵌套深度
* 减少`DOM`数量
* 减少无语义代码
* `HTML`压缩
* 删除多余标签和属性
* 使用相对路径

### `CSS` 和 `js`加载位置

* `CSS`放在`head`

  > `CSS` 加载不会阻塞` DOM tree` 解析，但是会阻塞 `DOM Tree` 渲染（减少渲染次数），也会阻塞后面 `JS` 执行（防止`js`读取样式）。放在`head`是尽早加载`CSS`。减少页面白屏时间。

* `js`放在`html`底部

  > `js`会阻塞`DOM`的解析，并且浏览器遇到 `<sciprt>`且没有`defer`或`async`属性的 标签时，会触发页面渲染，因而如果前面`CSS`资源尚未加载完毕时，浏览器会等待它加载完毕在执行脚本。如果放在`head`也会导致页面长时间白屏。



### 用户体验

* 设置 `favicon.ico`
* 添加骨架屏



## CSS 优化

### 减少样式表大小

* 使用缩写语句
* 删除不必要的单位和分号
* 删除空格和注释（压缩）

### 尽量避免一些属性或属性值

* CSS表达式
* 
* 避免使用占用过多CPU和内存的属性值
  * text-indent: -99999px
* 避免使用好点了打的属性
  * `CSS3 3D transform`
  * `transtion`

### 选择器的合理使用

* 避免通配符
* 减少选择器层数
* 避免类正则的属性选择器

